{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BLOOD BANK MANAGEMENT</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .form-control.is-invalid {
      border-color: #dc3545;
      box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
    }
    .error-message {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      color: #dc3545;
      font-size: 0.875rem;
      margin-top: 4px;
    }
    .error-icon {
      flex-shrink: 0;
      font-size: 1rem;
      line-height: 1;
      margin-top: 2px;
    }
  </style>
</head>
<body class="bg-dark text-light" style="min-height: 100vh;">

<!-- Navbar -->
<nav class="navbar bg-dark border-bottom border-light justify-content-center py-3 mb-4">
  <span class="navbar-brand mb-0 h1 text-light" style="font-family: 'Segoe UI', sans-serif; font-size: 2rem;">
    BLOOD BANK MANAGEMENT
  </span>
</nav>

<div class="container d-flex justify-content-center align-items-center">
  <div class="row w-100 justify-content-center">
    <form method="post" enctype="multipart/form-data" class="row g-4 px-4 py-5 bg-secondary rounded-4 shadow-lg" style="max-width: 900px; margin: auto;">
      {% csrf_token %}
      <h2 class="text-center text-warning">User Signup</h2>

      {% if form.non_field_errors %}
        <div class="col-12">
          {% for error in form.non_field_errors %}
            <div class="error-message">
              <span class="error-icon">‚ö†Ô∏è</span>
              <span>{{ error }}</span>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Username -->
      <div class="col-12">
        <label for="{{ form.username.id_for_label }}" class="form-label">Username</label>
        {% if form.username.errors %}
          {{ form.username|add_class:"form-control is-invalid" }}
          {% for error in form.username.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.username|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Password -->
      <div class="col-md-6">
        <label for="{{ form.password1.id_for_label }}" class="form-label">Password</label>
        {% if form.password1.errors %}
          {{ form.password1|add_class:"form-control is-invalid" }}
          {% for error in form.password1.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.password1|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Confirm Password -->
      <div class="col-md-6">
        <label for="{{ form.password2.id_for_label }}" class="form-label">Confirm Password</label>
        {% if form.password2.errors %}
          {{ form.password2|add_class:"form-control is-invalid" }}
          {% for error in form.password2.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.password2|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Show Password Toggle -->
      <div class="col-12">
        <div class="form-check mt-2">
          <input type="checkbox" class="form-check-input" id="showPassword" onclick="togglePassword()">
          <label class="form-check-label" for="showPassword">Show Password</label>
        </div>
      </div>

      <!-- Full Name -->
      <div class="col-12">
        <label for="{{ form.full_name.id_for_label }}" class="form-label">Full Name</label>
        {% if form.full_name.errors %}
          {{ form.full_name|add_class:"form-control is-invalid" }}
          {% for error in form.full_name.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.full_name|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Date of Birth + Gender -->
      <div class="col-md-6">
        <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">Date of Birth</label>
        {% if form.date_of_birth.errors %}
          {{ form.date_of_birth|add_class:"form-control is-invalid" }}
          {% for error in form.date_of_birth.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.date_of_birth|add_class:"form-control" }}
        {% endif %}
      </div>
      <div class="col-md-6">
        <label for="{{ form.gender.id_for_label }}" class="form-label">Gender</label>
        {% if form.gender.errors %}
          {{ form.gender|add_class:"form-select is-invalid" }}
          {% for error in form.gender.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.gender|add_class:"form-select" }}
        {% endif %}
      </div>

      <!-- Email -->
      <div class="col-12">
        <label for="{{ form.email.id_for_label }}" class="form-label">Email Address</label>
        {% if form.email.errors %}
          {{ form.email|add_class:"form-control is-invalid" }}
          {% for error in form.email.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.email|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Phone -->
      <div class="col-12">
        <label for="{{ form.phone_number.id_for_label }}" class="form-label">Phone Number</label>
        {% if form.phone_number.errors %}
          {{ form.phone_number|add_class:"form-control is-invalid" }}
          {% for error in form.phone_number.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.phone_number|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- City, State, Pincode -->
      <div class="col-md-4">
        <label for="{{ form.city.id_for_label }}" class="form-label">City</label>
        {% if form.city.errors %}
          {{ form.city|add_class:"form-control is-invalid" }}
          {% for error in form.city.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.city|add_class:"form-control" }}
        {% endif %}
      </div>
      <div class="col-md-4">
        <label for="{{ form.state.id_for_label }}" class="form-label">State</label>
        {% if form.state.errors %}
          {{ form.state|add_class:"form-control is-invalid" }}
          {% for error in form.state.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.state|add_class:"form-control" }}
        {% endif %}
      </div>
      <div class="col-md-4">
        <label for="{{ form.pincode.id_for_label }}" class="form-label">Pincode</label>
        {% if form.pincode.errors %}
          {{ form.pincode|add_class:"form-control is-invalid" }}
          {% for error in form.pincode.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.pincode|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Blood Group -->
      <div class="col-12">
        <label for="{{ form.blood_group.id_for_label }}" class="form-label">Blood Group</label>
        {% if form.blood_group.errors %}
          {{ form.blood_group|add_class:"form-select is-invalid" }}
          {% for error in form.blood_group.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.blood_group|add_class:"form-select" }}
        {% endif %}
      </div>

      <!-- Captcha -->
      <div class="col-12">
        <label for="{{ form.captcha.id_for_label }}" class="form-label">Captcha</label>
        {% if form.captcha.errors %}
          {{ form.captcha|add_class:"form-control is-invalid" }}
          {% for error in form.captcha.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.captcha|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Share Health Info -->
      <div class="col-12">
        <div class="form-check">
          {{ form.share_health_info|add_class:"form-check-input" }}
          <label class="form-check-label" for="{{ form.share_health_info.id_for_label }}">
            {{ form.share_health_info.label }}
          </label>
        </div>
      </div>

      <!-- Existing Conditions -->
      <div class="col-12">
        <label for="{{ form.existing_conditions.id_for_label }}" class="form-label">Existing Conditions</label>
        {% if form.existing_conditions.errors %}
          {{ form.existing_conditions|add_class:"form-control is-invalid" }}
          {% for error in form.existing_conditions.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.existing_conditions|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Ongoing Medication -->
      <div class="col-12">
        <label for="{{ form.ongoing_medication.id_for_label }}" class="form-label">Ongoing Medication</label>
        {% if form.ongoing_medication.errors %}
          {{ form.ongoing_medication|add_class:"form-control is-invalid" }}
          {% for error in form.ongoing_medication.errors %}
            <div class="error-message"><span class="error-icon">‚ö†Ô∏è</span><span>{{ error }}</span></div>
          {% endfor %}
        {% else %}
          {{ form.ongoing_medication|add_class:"form-control" }}
        {% endif %}
      </div>

      <!-- Submit -->
      <div class="col-12">
        <button type="submit" class="btn btn-primary w-100">Sign Up</button>
      </div>

      <!-- Alt Links -->
      <div class="col-12 text-center mt-2">
        <p class="mb-1">Already have an account?</p>
        <a href="{% url 'login' %}" class="btn btn-outline-light btn-sm me-2">Login</a>
        <a href="{% url 'admin_login' %}" class="btn btn-outline-light btn-sm">Admin Login</a>
      </div>
    </form>
  </div>
</div>

<!-- Footer (Outside the Form) -->
<footer class="text-center mt-5 text-light">
  <p class="mb-0 d-flex justify-content-center align-items-center gap-3 flex-wrap">
    Made with ‚ù§Ô∏è by Dino ¬∑
    <span onclick="copyEmail()" style="cursor: pointer; color: #ffc107;" title="Click to copy">
      jacksondino00@gmail.com
    </span>
    <a href="{% url 'about' %}" class="btn btn-outline-warning btn-sm">About Me</a>
  </p>
</footer>

<!-- Scripts -->
<script>
  function togglePassword() {
    const pwd1 = document.getElementById("id_password1");
    const pwd2 = document.getElementById("id_password2");
    const type = pwd1.type === "password" ? "text" : "password";
    pwd1.type = type;
    pwd2.type = type;
  }

  function copyEmail() {
    const email = "jacksondino00@gmail.com";
    navigator.clipboard.writeText(email).then(() => {
      alert("Email copied to clipboard! üìã");
    }, () => {
      alert("Failed to copy email.");
    });
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
